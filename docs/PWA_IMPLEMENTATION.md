# PWA (Progressive Web App) - Documentaci√≥n de Implementaci√≥n

**Fecha:** 2025-10-24
**Feature:** Instalaci√≥n de PWA con bot√≥n personalizado
**Estado:** ‚úÖ Completado y listo para uso

---

## üìã Resumen

Se ha implementado soporte completo de PWA (Progressive Web App) en GOL360, permitiendo a los usuarios instalar la aplicaci√≥n en sus dispositivos m√≥viles y de escritorio como si fuera una app nativa.

---

## ‚úÖ Caracter√≠sticas Implementadas

### 1. **Configuraci√≥n PWA Completa**

#### Archivos PWA Creados:

```
src-pwa/
‚îú‚îÄ‚îÄ manifest.json                # Configuraci√≥n de la app
‚îú‚îÄ‚îÄ register-service-worker.ts   # Registro del Service Worker
‚îî‚îÄ‚îÄ custom-service-worker.ts     # Service Worker personalizado (para modo InjectManifest)
```

#### Configuraci√≥n en `quasar.config.ts`:

- ‚úÖ Modo PWA: `GenerateSW` (genera Service Worker autom√°ticamente)
- ‚úÖ Cache Strategy para Firebase Storage: `CacheFirst` (30 d√≠as)
- ‚úÖ Cache Strategy para Firestore: `NetworkFirst` (1 hora)
- ‚úÖ Cleanup de cach√©s antiguos autom√°tico
- ‚úÖ Meta tags PWA inyectados autom√°ticamente
- ‚úÖ Skip waiting y clients claim habilitados

**Cache Strategies:**

```typescript
// Firebase Storage - CacheFirst (im√°genes, fotos de perfil)
- Expiration: 30 d√≠as
- Max Entries: 50 archivos
- Statuses cacheables: 0, 200

// Firestore API - NetworkFirst (datos en tiempo real)
- Network timeout: 10 segundos
- Expiration: 1 hora
- Max Entries: 50 requests
```

---

### 2. **Manifest PWA (`manifest.json`)**

**Configuraci√≥n:**

```json
{
  "name": "GOL360",
  "short_name": "GOL360",
  "description": "Plataforma de an√°lisis deportivo y streaming en vivo",
  "display": "standalone",
  "orientation": "portrait",
  "background_color": "#ffffff",
  "theme_color": "#1976d2",
  "categories": ["sports", "entertainment"]
}
```

**Iconos requeridos:**
- ‚úÖ 128x128px
- ‚úÖ 192x192px (m√≠nimo Android)
- ‚úÖ 256x256px
- ‚úÖ 384x384px
- ‚úÖ 512x512px (recomendado Android)

**‚ö†Ô∏è NOTA IMPORTANTE:** Los iconos actuales son placeholders (copias del 128x128). Se recomienda generar iconos optimizados en cada tama√±o.

---

### 3. **Componente de Instalaci√≥n (`InstallPWA.vue`)**

**Ubicaci√≥n:** `src/components/common/InstallPWA.vue`

#### Funcionalidades:

- ‚úÖ Detecta si la app ya est√° instalada
- ‚úÖ Escucha el evento `beforeinstallprompt`
- ‚úÖ Muestra bot√≥n solo cuando la instalaci√≥n est√° disponible
- ‚úÖ Maneja el prompt de instalaci√≥n del navegador
- ‚úÖ Notificaciones de √©xito/cancelaci√≥n
- ‚úÖ Oculta autom√°ticamente el bot√≥n despu√©s de instalar
- ‚úÖ Responsive (diferentes vistas para mobile/desktop)

#### Props Disponibles:

| Prop | Tipo | Default | Descripci√≥n |
|------|------|---------|-------------|
| `label` | String | 'Instalar App' | Texto del bot√≥n |
| `icon` | String | 'install_mobile' | Icono del bot√≥n |
| `color` | String | 'primary' | Color del bot√≥n |
| `flat` | Boolean | false | Estilo plano |
| `outline` | Boolean | true | Estilo outline |
| `rounded` | Boolean | false | Bordes redondeados |
| `unelevated` | Boolean | false | Sin elevaci√≥n |
| `size` | String | 'md' | Tama√±o del bot√≥n |
| `dense` | Boolean | false | Tama√±o compacto |
| `showTooltip` | Boolean | true | Mostrar tooltip |

#### Ejemplo de Uso:

```vue
<!-- Bot√≥n simple -->
<InstallPWA />

<!-- Bot√≥n personalizado -->
<InstallPWA
  label="Descargar App"
  icon="download"
  color="green"
  rounded
  unelevated
/>

<!-- Bot√≥n solo icono (mobile) -->
<InstallPWA
  icon="install_mobile"
  label=""
  dense
  flat
/>
```

---

### 4. **Integraci√≥n en MainLayout**

**Ubicaci√≥n:** `src/layouts/MainLayout.vue`

El bot√≥n de instalaci√≥n se agreg√≥ en el header, junto al bot√≥n de logout:

```vue
<div v-if="isLoggedIn" class="row items-center q-gutter-sm">
  <!-- Desktop: con tooltip -->
  <InstallPWA
    icon="install_mobile"
    label=""
    dense
    flat
    :show-tooltip="true"
    class="gt-sm"
  />

  <!-- Mobile: sin tooltip -->
  <InstallPWA
    icon="install_mobile"
    label=""
    dense
    flat
    :show-tooltip="false"
    class="lt-md"
  />

  <q-btn dense flat round icon="info" label="Info" @click="handleLogout" />
</div>
```

---

## üîß C√≥mo Funciona

### 1. **Detecci√≥n de Disponibilidad**

El componente `InstallPWA` detecta autom√°ticamente:

- ‚úÖ Si el navegador soporta instalaci√≥n PWA
- ‚úÖ Si la app ya est√° instalada
- ‚úÖ Si el usuario est√° en HTTPS (requerido)
- ‚úÖ Si cumple los criterios de instalaci√≥n

**Criterios de instalaci√≥n:**
- Manifest.json v√°lido
- Service Worker registrado
- Servido sobre HTTPS
- Usuario ha interactuado con el sitio

### 2. **Evento `beforeinstallprompt`**

```typescript
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault() // Prevenir prompt autom√°tico del navegador
  deferredPrompt = e // Guardar para uso posterior
  showButton = true  // Mostrar nuestro bot√≥n personalizado
})
```

### 3. **Instalaci√≥n**

Cuando el usuario hace clic en el bot√≥n:

1. Se llama a `deferredPrompt.prompt()`
2. El navegador muestra su di√°logo nativo
3. Se espera la respuesta del usuario
4. Se muestra notificaci√≥n de √©xito/cancelaci√≥n
5. Se oculta el bot√≥n

### 4. **Estados de la App**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Usuario entra al sitio (HTTPS)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
               ‚ñº
    ¬øYa est√° instalada?
               ‚îÇ
       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ               ‚îÇ
      S√ç              NO
       ‚îÇ               ‚îÇ
       ‚ñº               ‚ñº
  Ocultar bot√≥n   Mostrar bot√≥n
                       ‚îÇ
                       ‚ñº
                  Usuario hace clic
                       ‚îÇ
                       ‚ñº
               Prompt del navegador
                       ‚îÇ
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚îÇ                 ‚îÇ
         Acepta            Cancela
              ‚îÇ                 ‚îÇ
              ‚ñº                 ‚ñº
        Instala app      Oculta prompt
              ‚îÇ
              ‚ñº
      Ocultar bot√≥n
```

---

## üöÄ Uso y Comandos

### Desarrollo

**Modo SPA (normal):**
```bash
quasar dev
```

**Modo PWA (con Service Worker):**
```bash
quasar dev -m pwa
```

‚ö†Ô∏è **IMPORTANTE:** El Service Worker solo funciona en producci√≥n o en `localhost`. No funciona en IPs locales (ej: 192.168.x.x).

### Build de Producci√≥n

**Build SPA:**
```bash
quasar build
# Output: dist/spa/
```

**Build PWA:**
```bash
quasar build -m pwa
# Output: dist/pwa/
```

### Deploy a Firebase

#### Opci√≥n 1: Deploy SPA (como antes)
```bash
quasar build
firebase deploy --only hosting
```

#### Opci√≥n 2: Deploy PWA (recomendado)

1. **Actualizar `firebase.json`:**
```json
{
  "hosting": {
    "public": "dist/pwa",  // Cambiar de "dist/spa" a "dist/pwa"
    ...
  }
}
```

2. **Build y deploy:**
```bash
quasar build -m pwa
firebase deploy --only hosting
```

---

## üì± Pruebas

### Testing Local (Desarrollo)

1. **Iniciar en modo PWA:**
```bash
quasar dev -m pwa
```

2. **Abrir Chrome DevTools:**
   - Application tab
   - Service Workers (verificar que est√© activo)
   - Manifest (verificar configuraci√≥n)

3. **Simular instalaci√≥n:**
   - En Chrome: DevTools > Application > Manifest > "Add to home screen"

### Testing en Dispositivo Real

#### Android:

1. **Deploy a Firebase Hosting:**
```bash
quasar build -m pwa
firebase deploy --only hosting
```

2. **Acceder desde Chrome en Android:**
   - Ir a la URL de producci√≥n
   - Chrome mostrar√° banner de instalaci√≥n autom√°tico
   - O usar el bot√≥n "Instalar App" en el header

3. **Verificar instalaci√≥n:**
   - Buscar icono "GOL360" en pantalla de inicio
   - Abrir app (debe abrir en pantalla completa, sin barra de navegador)
   - Verificar que funciona offline (modo avi√≥n)

#### iOS (Safari):

‚ö†Ô∏è **LIMITACI√ìN:** iOS no soporta el evento `beforeinstallprompt`, por lo que nuestro bot√≥n **NO aparecer√°** en Safari.

**Instalaci√≥n manual en iOS:**
1. Abrir sitio en Safari
2. Tap en bot√≥n "Compartir" (√≠cono de cuadro con flecha)
3. Scroll y tap en "Agregar a pantalla de inicio"
4. Confirmar nombre y tap "Agregar"

**Nota:** Se puede agregar un banner informativo para usuarios iOS explicando c√≥mo instalar manualmente.

---

## üé® Personalizaci√≥n

### Cambiar colores del tema

Editar `quasar.config.ts`:

```typescript
pwa: {
  extendManifestJson (json) {
    json.theme_color = '#ff0000'        // Color de la barra de estado
    json.background_color = '#ffffff'   // Color de splash screen
  }
}
```

### Agregar splash screen personalizado

Crear iconos con `maskable` para Android:

```json
{
  "icons": [
    {
      "src": "icons/icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any maskable"
    }
  ]
}
```

### Cambiar estrategia de cach√©

Editar `quasar.config.ts`:

```typescript
extendGenerateSWOptions (cfg) {
  cfg.runtimeCaching = [
    {
      urlPattern: /tu-api\.com/,
      handler: 'NetworkFirst', // Opciones: CacheFirst, NetworkFirst, NetworkOnly, CacheOnly
      options: {
        cacheName: 'mi-cache',
        expiration: {
          maxEntries: 100,
          maxAgeSeconds: 60 * 60 * 24 * 7 // 7 d√≠as
        }
      }
    }
  ]
}
```

---

## üêõ Troubleshooting

### El bot√≥n de instalaci√≥n no aparece

**Posibles causas:**

1. **La app ya est√° instalada**
   - Soluci√≥n: Desinstalar y recargar

2. **No est√°s en HTTPS**
   - Soluci√≥n: Usar Firebase Hosting o localhost

3. **Service Worker no registrado**
   - Verificar: Chrome DevTools > Application > Service Workers
   - Soluci√≥n: Hacer hard refresh (Ctrl+Shift+R)

4. **Navegador no soporta PWA**
   - iOS Safari no dispara `beforeinstallprompt`
   - Soluci√≥n: Instrucciones manuales para iOS

### Service Worker no se actualiza

**Problema:** Cambios en el c√≥digo no se reflejan en la app instalada

**Soluci√≥n:**

1. **Forzar actualizaci√≥n del SW:**
```typescript
// En register-service-worker.ts
updated(registration) {
  // Forzar activaci√≥n inmediata
  registration.waiting?.postMessage({ type: 'SKIP_WAITING' })
  window.location.reload()
}
```

2. **Limpiar cach√©:**
   - Chrome DevTools > Application > Clear storage > "Clear site data"

3. **Actualizar versi√≥n:**
   - Cambiar algo en el c√≥digo y rebuild
   - Quasar genera nuevo hash del SW autom√°ticamente

### App no funciona offline

**Verificar:**

1. **Service Worker activo:**
```bash
Chrome DevTools > Application > Service Workers > Status: "activated"
```

2. **Recursos en cach√©:**
```bash
Chrome DevTools > Application > Cache Storage
```

3. **Estrategia de cach√© correcta:**
   - Assets est√°ticos: `CacheFirst`
   - APIs din√°micas: `NetworkFirst` con fallback

---

## üìä M√©tricas y Monitoreo

### Verificar instalaciones

**Google Analytics (futuro):**
```typescript
// En register-service-worker.ts
window.addEventListener('appinstalled', () => {
  // Track en GA
  gtag('event', 'app_installed', {
    event_category: 'PWA',
    event_label: 'Installation'
  })
})
```

### Verificar uso offline

```typescript
window.addEventListener('online', () => {
  console.log('App online')
})

window.addEventListener('offline', () => {
  console.log('App offline')
})
```

---

## üîê Seguridad

### HTTPS Requerido

- ‚úÖ Firebase Hosting ya usa HTTPS
- ‚ö†Ô∏è No funciona en HTTP (excepto localhost)

### Service Worker Scope

El Service Worker controla todas las requests de tu dominio:

```
https://tu-app.web.app/
  ‚îú‚îÄ‚îÄ / (controlado)
  ‚îú‚îÄ‚îÄ /admin (controlado)
  ‚îú‚îÄ‚îÄ /profile (controlado)
  ‚îî‚îÄ‚îÄ ...
```

### Actualizaci√≥n de contenido sensible

Para datos sensibles que NO deben cachearse:

```typescript
// quasar.config.ts
cfg.runtimeCaching = [
  {
    urlPattern: /\/api\/secure\/.*/,
    handler: 'NetworkOnly', // Nunca cachear
  }
]
```

---

## üìù Mejoras Futuras

### 1. **Notificaciones Push**

```typescript
// Pedir permiso
const permission = await Notification.requestPermission()

if (permission === 'granted') {
  // Suscribir a FCM (Firebase Cloud Messaging)
}
```

### 2. **Background Sync**

Sincronizar datos cuando el usuario vuelva online:

```typescript
// Service Worker
self.addEventListener('sync', (event) => {
  if (event.tag === 'sync-matches') {
    event.waitUntil(syncMatches())
  }
})
```

### 3. **Periodic Background Sync**

Actualizar datos en background cada X tiempo:

```typescript
const status = await navigator.permissions.query({
  name: 'periodic-background-sync'
})

if (status.state === 'granted') {
  await registration.periodicSync.register('update-scores', {
    minInterval: 60 * 1000 // 1 minuto
  })
}
```

### 4. **Share Target API**

Permitir compartir contenido hacia la app:

```json
{
  "share_target": {
    "action": "/share",
    "method": "POST",
    "enctype": "multipart/form-data",
    "params": {
      "title": "title",
      "text": "text",
      "url": "url"
    }
  }
}
```

### 5. **Badging API**

Mostrar badge con n√∫mero de notificaciones:

```typescript
navigator.setAppBadge(5) // Muestra "5" en el icono
navigator.clearAppBadge() // Quita el badge
```

### 6. **Banner para iOS**

Agregar componente que detecte iOS y muestre instrucciones:

```vue
<q-banner v-if="isIOS && !isInstalled" class="bg-info">
  Para instalar: tap en <q-icon name="ios_share" /> y luego "Agregar a pantalla de inicio"
</q-banner>
```

---

## üìû Checklist de Testing

### Pre-Deploy

- [ ] Build PWA sin errores (`quasar build -m pwa`)
- [ ] Manifest v√°lido (Chrome DevTools)
- [ ] Service Worker registrado
- [ ] Todos los iconos existen (128, 192, 256, 384, 512)
- [ ] Meta tags PWA inyectados
- [ ] Cache strategies configuradas

### Post-Deploy

- [ ] Bot√≥n de instalaci√≥n aparece en desktop
- [ ] Bot√≥n de instalaci√≥n aparece en Android
- [ ] Click en bot√≥n muestra prompt nativo
- [ ] App se instala correctamente
- [ ] Icono aparece en pantalla de inicio
- [ ] App abre en modo standalone (sin barra de navegador)
- [ ] App funciona offline (modo avi√≥n)
- [ ] Recursos est√°ticos se cachean
- [ ] Notificaciones de actualizaci√≥n funcionan
- [ ] Desinstalar y reinstalar funciona

### iOS (Manual)

- [ ] Safari puede acceder al sitio
- [ ] "Agregar a pantalla de inicio" funciona
- [ ] App abre en modo standalone
- [ ] Iconos se muestran correctamente

---

## üéØ Resumen de Archivos

```
Gol-360-App/
‚îú‚îÄ‚îÄ src-pwa/
‚îÇ   ‚îú‚îÄ‚îÄ manifest.json                    ‚ú® NUEVO
‚îÇ   ‚îú‚îÄ‚îÄ register-service-worker.ts       ‚ú® NUEVO
‚îÇ   ‚îî‚îÄ‚îÄ custom-service-worker.ts         ‚ú® NUEVO
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ common/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ InstallPWA.vue           ‚ú® NUEVO
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ layouts/
‚îÇ       ‚îî‚îÄ‚îÄ MainLayout.vue               üìù MODIFICADO
‚îÇ
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ icons/
‚îÇ       ‚îú‚îÄ‚îÄ icon-128x128.png             ‚ú® NUEVO
‚îÇ       ‚îú‚îÄ‚îÄ icon-192x192.png             ‚ú® NUEVO
‚îÇ       ‚îú‚îÄ‚îÄ icon-256x256.png             ‚ú® NUEVO
‚îÇ       ‚îú‚îÄ‚îÄ icon-384x384.png             ‚ú® NUEVO
‚îÇ       ‚îî‚îÄ‚îÄ icon-512x512.png             ‚ú® NUEVO
‚îÇ
‚îú‚îÄ‚îÄ quasar.config.ts                     üìù MODIFICADO
‚îú‚îÄ‚îÄ firebase.json                        ‚ö†Ô∏è PENDIENTE (cambiar a dist/pwa)
‚îÇ
‚îî‚îÄ‚îÄ docs/
    ‚îî‚îÄ‚îÄ PWA_IMPLEMENTATION.md            üìÑ ESTE ARCHIVO
```

---

**√öltima actualizaci√≥n:** 2025-10-24
**Estado:** ‚úÖ Implementaci√≥n completa
**Pr√≥ximo paso:** Generar iconos optimizados y desplegar en producci√≥n
**Autor:** Claude Code AI Assistant
